<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>BigQuery with R on Data Science | ChloEvan</title>
    <link>https://chloevan.github.io/tags/bigquery-with-r/</link>
    <description>Recent content in BigQuery with R on Data Science | ChloEvan</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 21 Apr 2020 11:40:30 +0900</lastBuildDate>
    
        <atom:link href="https://chloevan.github.io/tags/bigquery-with-r/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Ch04_bigquery_with_R</title>
      <link>https://chloevan.github.io/gcp/bigquery/01_settings/ch04_bigquery_with_r/</link>
      <pubDate>Tue, 21 Apr 2020 11:40:30 +0900</pubDate>
      
      <guid>https://chloevan.github.io/gcp/bigquery/01_settings/ch04_bigquery_with_r/</guid>
      <description>&lt;h2 id=&#34;1-구글-클라우드-설정&#34;&gt;1. 구글 클라우드 설정&lt;/h2&gt;
&lt;p&gt;본격적인 빅쿼리 실습에 앞서서, R과 연동하는 예제를 준비하였다. 빅쿼리 시작에 앞서서 선행적으로 클라우드 사용을 해야 한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;만약 GCP 프로젝트가 없다면, 계정을 연동한다. Go to &lt;a href=&#34;https://console.cloud.google.com/cloud-resource-manager&#34;&gt;Cloud Resource Manager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;그리고, 비용결제를 위한 카드를 등록한다. &lt;a href=&#34;https://support.google.com/cloud/answer/6293499#enable-billing&#34;&gt;Enable billing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;마지막으로 BigQuery API를 사용해야 하기 때문에 빅쿼리 API 사용허가를 내준다.&lt;a href=&#34;https://console.cloud.google.com/flows/enableapi?apiid=bigquery&#34;&gt;Enable BigQuery&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;위 API를 이용하지 않으면 &lt;code&gt;Python&lt;/code&gt; 또는 &lt;code&gt;R&lt;/code&gt;과 연동해서 사용할 수는 없다. 자주 쓰는것이 아니라면 비용은 거의 발생하지 않으니 염려하지 않아도 된다. 비용관리에 대한 자세한 내용은 &lt;a href=&#34;https://cloud.google.com/bigquery/docs/best-practices-costs?hl=ko&#34;&gt;BigQuery 권장사항: 비용 관리&lt;/a&gt;에서 확인하기를 바란다.&lt;/p&gt;
&lt;h2 id=&#34;2-사용자-계정-인증&#34;&gt;2. 사용자 계정 인증&lt;/h2&gt;
&lt;p&gt;구글 코랩을 사용해서 인증 절차를 밟도록 한다. 아래 소스코드는 변경시키지 않는다. 아래 절차대로 진행하면 된다. &lt;code&gt;Gmail&lt;/code&gt; 인증 절차와 비슷하다.&lt;/p&gt;
&lt;h2 id=&#34;3-bigrquery-r-패키지-로드&#34;&gt;3. Bigrquery R 패키지 로드&lt;/h2&gt;
&lt;p&gt;패키지 설치가 되어 있지 않다면 아래 소스코드를 통해 패키지를 불러온다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install.packages(&amp;#34;bigrquery&amp;#34;)&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(bigrquery)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;4-사용자-계정-인증&#34;&gt;4. 사용자 계정 인증&lt;/h2&gt;
&lt;p&gt;구글 코랩을 사용해서 인증 절차를 밟도록 한다. 아래 소스코드는 변경시키지 않는다. 아래 절차대로 진행하면 된다. &lt;code&gt;Gmail&lt;/code&gt; 인증 절차와 비슷하다. 이 때, &lt;code&gt;Enter authorization code:&lt;/code&gt; 입력하는 부분에서 인증키를 복사한 후 붙여넣기 하면 된다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Provide authentication&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;bq_auth&lt;/span&gt;(use_oob &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;TRUE&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;5-데이터-연동&#34;&gt;5. 데이터 연동&lt;/h2&gt;
&lt;p&gt;사용자 계정 인증이 완료 되었다면, 이제 데이터를 불러오자. 이 때 중요한 것은 &lt;code&gt;project_id&lt;/code&gt;를 입력해줘야 하는 것이다.&lt;/p&gt;
&lt;h3 id=&#34;1-low-level-api&#34;&gt;(1) Low-Level API&lt;/h3&gt;
&lt;p&gt;직접 빅쿼리 프로젝트 ID를 이용해 연동해본다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;billing &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bigquerytutorial-274406&amp;#34;&lt;/span&gt;
sql &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;SELECT COUNT(*) as total_rows FROM `bigquery-public-data.samples.gsod`&amp;#34;&lt;/span&gt;

tb &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bq_project_query&lt;/span&gt;(billing, sql)
&lt;span style=&#34;color:#75715e&#34;&gt;## Complete&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Billed: 0 B&lt;/span&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;bq_table_download&lt;/span&gt;(tb)
&lt;span style=&#34;color:#75715e&#34;&gt;# A tibble: 1 x 1                                                         &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  total_rows&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#       &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1  114420316&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2-dbi를-활용한-연동&#34;&gt;(2) DBI를 활용한 연동&lt;/h3&gt;
&lt;p&gt;이번에는 R의 데이터베이스 인터페이스인 &lt;code&gt;DBI&lt;/code&gt;를 활용해서 데이터를 불러온다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(DBI)
con &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dbConnect&lt;/span&gt;(
  bigrquery&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;bigquery&lt;/span&gt;(), 
  project &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bigquery-public-data&amp;#34;&lt;/span&gt;, 
  dataset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;samples&amp;#34;&lt;/span&gt;, 
  billing &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; billing
)

con
&lt;span style=&#34;color:#75715e&#34;&gt;# &amp;lt;BigQueryConnection&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  Dataset: bigquery-public-data.samples&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  Billing: bigquerytutorial-274406&lt;/span&gt;


&lt;span style=&#34;color:#a6e22e&#34;&gt;dbGetQuery&lt;/span&gt;(con, sql, n &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# Complete&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Billed: 0 B&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Downloading 1 rows in 1 pages.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## A tibble: 1 x 1                                                         &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  total_rows&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#       &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#1  114420316&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3-dplyr를-활용한-빅쿼리-연동&#34;&gt;(3) dplyr를 활용한 빅쿼리 연동&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-r&#34; data-lang=&#34;r&#34;&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;library&lt;/span&gt;(dplyr)
&lt;span style=&#34;color:#a6e22e&#34;&gt;dbListTables&lt;/span&gt;(con)
&lt;span style=&#34;color:#75715e&#34;&gt;# [1] &amp;#34;github_nested&amp;#34;   &amp;#34;github_timeline&amp;#34; &amp;#34;gsod&amp;#34;            &amp;#34;natality&amp;#34;       &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# [5] &amp;#34;shakespeare&amp;#34;     &amp;#34;trigrams&amp;#34;        &amp;#34;wikipedia&amp;#34;  &lt;/span&gt;

gsod &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tbl&lt;/span&gt;(con, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gsod&amp;#34;&lt;/span&gt;)
gsod &lt;span style=&#34;color:#f92672&#34;&gt;%&amp;gt;%&lt;/span&gt; 
  &lt;span style=&#34;color:#a6e22e&#34;&gt;summarise&lt;/span&gt;(total_rows &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;n&lt;/span&gt;())

&lt;span style=&#34;color:#75715e&#34;&gt;# Running job &amp;#39;bigquerytutorial-274406.job_fe5MbF0IChh7fRBBhPKYHZSHN3qz.U...&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Complete&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Billed: 0 B&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Downloading 1 rows in 1 pages.&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Source:   lazy query [?? x 1]                                           &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;## Database: BigQueryConnection&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  total_rows&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#       &amp;lt;int&amp;gt;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1  114420316&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;똑같은 결과값을 내기 위해서 서로 다른 패키지를 활용해서 출력하는 것을 확인하였다. 지금까지, R과 빅쿼리 연동에 대해서 짧게 배우는 시간을 가졌다.&lt;/p&gt;
&lt;p&gt;자세한 건 공식문서를 확인하기를 바란다.&lt;/p&gt;
&lt;h2 id=&#34;6-파이썬과-빅쿼리-연동&#34;&gt;6. 파이썬과 빅쿼리 연동&lt;/h2&gt;
&lt;p&gt;파이썬과 빅쿼리 연동하는 예제는 &lt;a href=&#34;https://chloevan.github.io/gcp/bigquery/01_settings/ch03_bigquery_with_python/&#34;&gt;Ch03_bigquery_with_python&lt;/a&gt;에서 확인하기를 바란다.&lt;/p&gt;
&lt;h2 id=&#34;7-reference&#34;&gt;7. Reference&lt;/h2&gt;
&lt;p&gt;Schendzielorz, Tim  M. “Google Big Query with R.” R, 20 Mar. 2020, &lt;a href=&#34;http://www.r-bloggers.com/google-big-query-with-r/&#34;&gt;www.r-bloggers.com/google-big-query-with-r/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;RStudio. “Databases Using R.” Databases Using R, db.rstudio.com/databases/big-query/.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>